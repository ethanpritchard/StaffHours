package com.ethanpritchard.staffhours;

import java.util.UUID;
import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.Server;
import org.bukkit.command.Command;
import org.bukkit.command.CommandSender;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.entity.Player;
import org.bukkit.plugin.java.JavaPlugin;
import org.bukkit.scheduler.BukkitScheduler;

public class Main
extends JavaPlugin {
 public void onEnable() {
  saveDefaultConfig();
  Repeater();
 }

 public void Repeater() {
  BukkitScheduler scheduler = Bukkit.getServer().getScheduler();
  scheduler.scheduleSyncRepeatingTask(this, new Runnable() {
   public void run() {
    for (Player p: Bukkit.getServer().getOnlinePlayers()) {
     UUID uuid = p.getUniqueId();
     int seconds = Main.this.getConfig().getInt("data." + uuid + ".seconds");
     int minutes = Main.this.getConfig().getInt("data." + uuid + ".minutes");
     int hours = Main.this.getConfig().getInt("data." + uuid + ".hours");

     int sec = seconds + 1;
     if (sec >= 60) {
      Main.this.getConfig().set("data." + uuid + ".seconds", Integer.valueOf(0));
      Main.this.saveConfig();
      int min = minutes + 1;
      if (min >= 60) {
       Main.this.getConfig().set("data." + uuid + ".minutes", Integer.valueOf(0));
       Main.this.saveConfig();
       int ho = hours + 1;
       Main.this.getConfig().set("data." + uuid + ".hours", Integer.valueOf(ho));
       Main.this.saveConfig();
      } else {
       Main.this.getConfig().set("data." + uuid + ".minutes", Integer.valueOf(min));
       Main.this.saveConfig();
      }
     } else {
      Main.this.getConfig().set("data." + uuid + ".seconds", Integer.valueOf(sec));
      Main.this.saveConfig();
     }
    }
   }
  }, 0 L, 20 L);
 }

 public boolean onCommand(CommandSender sender, Command cmd, String label, String[] args) {
  Player player = (Player) sender;
  if (cmd.getLabel().equalsIgnoreCase("hours")) {
   if (!(sender instanceof Player)) {
    return true;
   }
   if (args.length == 1) {
    Player p = player.getServer().getPlayer(args[0]);
    UUID uuid = p.getUniqueId();
    int hours = getConfig().getInt("data." + uuid + ".hours");
    player.sendMessage(ChatColor.GREEN + "-> " + p.getName() + " currently has " + hours + " hours logged.");
    return true;
   }
   int hours = getConfig().getInt("data." + player.getUniqueId() + ".hours");
   player.sendMessage(ChatColor.GREEN + "-> You currently have " + hours + " hours logged.");
   return true;
  }
  return false;
 }
}
